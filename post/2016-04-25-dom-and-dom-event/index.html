<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="dailydreamer的小空间">


<link rel="shortcut icon" href="/images/avatar.jpg" />

<meta name="keywords" content="DOM, DOM Event, HTML">
<title>DOM和DOM Event</title>

<link href="/index.xml" rel="alternate" type="application/rss+xml" title="dailydreamer" />
<link href="/index.xml" rel="feed" type="application/rss+xml" title="dailydreamer" />

<link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.min.css" rel="stylesheet" type="text/css">
<link href="  https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="/css/style.css" rel="stylesheet" type="text/css">


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-75912368-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <nav class="nav has-shadow">
  <div class="nav-left">
    <span id="toggle__menu" class="nav-toggle">
      <span></span>
      <span></span>
      <span></span>
    </span>
    <a href="/index.html" class="nav-item">Dailydreamer's Space</a>
  </div>

  <div class="nav-center">
    <a class="nav-item" href="https://github.com/dailydreamer">
      <span class="icon">
        <i class="fa fa-github"></i>
      </span>
    </a>
    <a class="nav-item" href="/index.xml" type="application/rss+xml">
      <span class="icon">
        <i class="fa fa-rss"></i>
      </span>
    </a>
  </div>
</nav>      

  <div id="container">
    <aside>
  <nav class="sidebar">
    <div id="tags__ul">
      <a id="all_posts" class="tag is-primary">
        全部 
        <span class="tag-count">23</span>
      </a>
      
      <a id="编程" class="tag">
        编程 
        <span class="tag-count">15</span>
      </a>
      
      <a id="读书笔记" class="tag">
        读书笔记 
        <span class="tag-count">10</span>
      </a>
      
      <a id="web" class="tag">
        web 
        <span class="tag-count">5</span>
      </a>
      
      <a id="elasticsearch" class="tag">
        elasticsearch 
        <span class="tag-count">3</span>
      </a>
      
      <a id="编程语言" class="tag">
        编程语言 
        <span class="tag-count">3</span>
      </a>
      
      <a id="产品经理" class="tag">
        产品经理 
        <span class="tag-count">2</span>
      </a>
      
      <a id="哲学" class="tag">
        哲学 
        <span class="tag-count">2</span>
      </a>
      
      <a id="ssh" class="tag">
        ssh 
        <span class="tag-count">1</span>
      </a>
      
      <a id="心理学" class="tag">
        心理学 
        <span class="tag-count">1</span>
      </a>
      
      <a id="理财" class="tag">
        理财 
        <span class="tag-count">1</span>
      </a>
      
      <a id="科学" class="tag">
        科学 
        <span class="tag-count">1</span>
      </a>
      
      <a id="系统安全" class="tag">
        系统安全 
        <span class="tag-count">1</span>
      </a>
      
      <a id="设计" class="tag">
        设计 
        <span class="tag-count">1</span>
      </a>
      
    </div>

    <div class="menu">
      <ul id="posts__ul" class="menu-list">
        
        
        <li class="all_posts 读书笔记 产品经理">
          <a href="https://dailydreamer.me/post/2016-06-16-mobile-application-experience/">
            <span class="posts-title">移动端体验</span>
            <span class="posts-date">Jun, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 理财">
          <a href="https://dailydreamer.me/post/2016-06-15-fund-tips/">
            <span class="posts-title">买基金给我加薪</span>
            <span class="posts-date">Jun, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/post/2016-06-09-inspired-by-functional-programing-language/">
            <span class="posts-title">从函数式语言想到的</span>
            <span class="posts-date">Jun, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/post/2016-05-25-webrtc-introduction/">
            <span class="posts-title">WebRTC简介</span>
            <span class="posts-date">May, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 设计">
          <a href="https://dailydreamer.me/post/2016-05-24-some-design-books/">
            <span class="posts-title">读过的一些设计书籍</span>
            <span class="posts-date">May, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/post/2016-04-25-dom-and-dom-event/">
            <span class="posts-title">DOM和DOM Event</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/post/2016-04-14-css-cheat-sheet/">
            <span class="posts-title">CSS Cheat Sheet</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/post/2016-04-09-spa-jwt-auth/">
            <span class="posts-title">单页应用JWT身份认证</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 web">
          <a href="https://dailydreamer.me/post/2016-04-08-cors-solve-same-origin-policy-problem/">
            <span class="posts-title">CORS解决单页应用跨域问题</span>
            <span class="posts-date">Apr, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 科学">
          <a href="https://dailydreamer.me/post/2016-03-20-a-new-kind-of-science/">
            <span class="posts-title">一种新科学</span>
            <span class="posts-date">Mar, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 心理学">
          <a href="https://dailydreamer.me/post/2016-03-07-difficult-conversation/">
            <span class="posts-title">关键对话</span>
            <span class="posts-date">Mar, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 哲学">
          <a href="https://dailydreamer.me/post/2016-01-13-power-of-myth/">
            <span class="posts-title">神话的力量</span>
            <span class="posts-date">Jan, 2016</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 系统安全">
          <a href="https://dailydreamer.me/post/2015-11-23-meet-ctf/">
            <span class="posts-title">一次与CTF的邂逅</span>
            <span class="posts-date">Nov, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 ssh">
          <a href="https://dailydreamer.me/post/2015-10-30-ssh-config/">
            <span class="posts-title">多个github账号的ssh key切换</span>
            <span class="posts-date">Oct, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 哲学">
          <a href="https://dailydreamer.me/post/2015-08-04-Zen-and-the-Art-of-Motorcycle-Maintenance/">
            <span class="posts-title">禅与摩托车维修的艺术</span>
            <span class="posts-date">Aug, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 产品经理">
          <a href="https://dailydreamer.me/post/2015-07-25-product-manager/">
            <span class="posts-title">人人都是产品经理</span>
            <span class="posts-date">Jul, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/post/2015-06-29-hiding-mouse-globally-in-wpf/">
            <span class="posts-title">WPF全局隐藏鼠标</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 编程">
          <a href="https://dailydreamer.me/post/2015-06-28-unix-programming-art/">
            <span class="posts-title">UNIX编程艺术</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 编程语言">
          <a href="https://dailydreamer.me/post/2015-06-23-python-yeild-and-parse-xml/">
            <span class="posts-title">Python解析XML与生成迭代器</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 elasticsearch">
          <a href="https://dailydreamer.me/post/2015-06-22-elasticsearch-config-2/">
            <span class="posts-title">ElasticSearch搜索配置（2）</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 elasticsearch">
          <a href="https://dailydreamer.me/post/2015-06-05-elasticsearch-config-1/">
            <span class="posts-title">ElasticSearch搜索配置（1）</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 读书笔记 编程">
          <a href="https://dailydreamer.me/post/2015-06-04-a-pragmatic-programmer/">
            <span class="posts-title">程序员修炼之道</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        <li class="all_posts 编程 elasticsearch">
          <a href="https://dailydreamer.me/post/2015-06-02-config-elasticsearch-on-aws/">
            <span class="posts-title">在AWS上配置ElasticSearch</span>
            <span class="posts-date">Jun, 2015</span>
          </a>
        </li>
        
        
        
        
      </ul>
    </div>
  </nav>
</aside>
    <article>
      <div class="content post">
        <h1 data-identifier="2016-04-25">DOM和DOM Event</h1>
        

<h2 id="dom和html-javascript-css的关系">DOM和HTML，JavaScript，CSS的关系</h2>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction">Document Object Model(DOM)</a>是W3C制定的一种语言无关的面向对象的文档模型，规定了一组可编程的interface需要实现的属性和方法。
HTML和XML文档实现了DOM，因此拥有面向对象的特性，其结构、样式、内容等可以被其他语言的DOM实现操纵。
DOM Level 4是2015年的最新一版标准。</p>

<p>HTML中<code>&lt;script&gt;</code>元素中嵌入的JavaScript就是DOM的一种实现，如下所示：</p>

<pre><code class="language-js">var paragraphs = document.getElementsByTagName(&quot;P&quot;);
// paragraphs[0] is the first &lt;p&gt; element
// paragraphs[1] is the second &lt;p&gt; element, etc.
alert(paragraphs[0].nodeName);
</code></pre>

<p>其中<code>document</code>对象，<code>getElementsByTagName</code>方法，<code>alert</code>方法，<code>nodeName</code>属性均是DOM标准规定的。</p>

<p>你也可以用其它语言操作DOM，如下的Python示例：</p>

<pre><code class="language-py"># Python DOM example
import xml.dom.minidom as m
doc = m.parse(&quot;test.xml&quot;);
doc.nodeName # DOM property of document object;
p_list = doc.getElementsByTagName(&quot;para&quot;);
</code></pre>

<p>HTML是一种文档标记语言，HTML元素除了实现DOM的interface之外，还实现了HTML标准中规定的一些interface。如下示例：</p>

<pre><code class="language-js">var table = document.getElementById(&quot;table&quot;);
var tableAttrs = table.attributes; // Node/Element interface
for (var i = 0; i &lt; tableAttrs.length; i++) {
  // HTMLTableElement interface: border attribute
  if(tableAttrs[i].nodeName.toLowerCase() == &quot;border&quot;)
    table.border = &quot;1&quot;;
}
// HTMLTableElement interface: summary attribute
table.summary = &quot;note: increased border&quot;;
</code></pre>

<p><code>attributes</code>属性是DOM标准，<code>border</code>和<code>summary</code>属性是HTML标准。</p>

<p>其它XML的方言如SVG等也有实现DOM之外的标准。</p>

<p>CSS是一种为DOM文档标记样式的语言，而DOM Element种的style属性被解释为行内样式表。</p>

<h2 id="dom-event">DOM Event</h2>

<p>DOM Level 2中规定了基本的<a href="https://www.w3.org/TR/DOM-Level-2-Events/events.html">DOM Event Model</a>，包括事件的处理流程以及注册方法等等。
这里主要讲一下事件处理流程，感觉和WPF的事件机制很相似。</p>

<h3 id="基本流程">基本流程</h3>

<p>在DOM implementation中触发事件后，触发事件的元素EventTarget被指定给Event对象的target属性。
如果该事件没有使用事件捕获和事件冒泡，那么所有的EventListener被执行后事件处理结束。
如果使用了事件捕获或事件冒泡，那么事件传播过程如后文所示，依次执行过程中所有元素上注册的该事件的EventListener。
执行过程是同步的，且一个EventListener内的异常不会影响后续EventListener的执行。</p>

<h3 id="事件捕获-event-capture">事件捕获(Event capture)</h3>

<p>事件捕获阶段，事件从DOM树的顶端元素，通常是Document，沿着EventTarget的祖先元素向EventTarget传播。
设置addEventListener方法的useCapture属性为true可以使该EventListener在事件捕获阶段截获由其后代元素产生的相应事件，同时该EventListener在事件冒泡阶段不会再被触发。</p>

<p>注意和WPF等基于delegation的模型不同的是，截获的是后代元素的相应事件，这意味者如果EventTarget上的设置useCapture的EventListener不会被触发，因为自己不是自己的后代；
并且指定的不是一个EventTarget，而是一种特定的事件类型，如果事件类型不同不会被触发。</p>

<h3 id="事件冒泡-event-bubbling">事件冒泡(Event bubbling)</h3>

<p>事件冒泡阶段，一开始和没有使用冒泡的事件一样，所有EventTarget上的EventListener都被执行。
然后从EventTarget沿着DOM树，向其祖先元素传播，直到DOM树顶端，过程和事件捕获相反。
设置了useCapture属性的EventListener不会在这一阶段被触发。</p>

<p>事件传播的链条在事件被触发时就已经确定，传播过程中DOM树的改变不影响传播过程。</p>

<h3 id="stoppropagation">stopPropagation</h3>

<p>在事件传播的过程中，如果一个EventListener调用了Event对象的stopPropagation方法，那么事件会停止传播，链条上后续元素的EventListener不会被触发。</p>

<h3 id="preventdefault">preventDefault</h3>

<p>一些事件被指定为cancelable。这些事件的DOM implementation通常都会有一些默认的事件处理方法。在这些事件上调用preventDefault方法可以阻止这些事件处理方法的执行。</p>

<p>如下例子展示了用preventDefault阻止非小写字母的输入。</p>

<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;preventDefault example&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;请输入一些字母,只允许小写字母.&lt;/p&gt;
&lt;form&gt;
&lt;input type=&quot;text&quot; id=&quot;my-textbox&quot;/&gt;
&lt;/form&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
function checkName(evt) {
var charCode = evt.charCode;
  if (charCode != 0) {
    if (charCode &lt; 97 || charCode &gt; 122) {
      evt.preventDefault();
      alert(&quot;只能输入小写字母.&quot; + &quot;\n&quot;
            + &quot;charCode: &quot; + charCode + &quot;\n&quot;
      );
    }
  }
}
document.getElementById('my-textbox').addEventListener(
    'keypress', checkName, false
 );
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h3 id="常用的mouseevent">常用的MouseEvent</h3>

<p>有click，mousedown，mouseup，mouseover，mousemove，mouseout。</p>

<p>click是在同一屏幕位置的mousedown和mouseup先后依次触发后被触发。</p>

<p>MouseEvent都会冒泡，并且除mousemove外都Cancelable。</p>

        <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'dailydreamer';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>      
    </article>
  </div>

  <script src="/js/zepto.min.js"></script>
<script src="/js/script.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/yaml.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>  
</body>
</html>
